<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteRecorder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ SiteRecorder</h1>
            <p>Automated Site Crawling & Recording</p>
        </header>

        <main>
            <!-- Settings Panel -->
            <section class="panel settings-panel">
                <h2>Recording Settings</h2>
                
                <div class="form-group">
                    <label for="url">Website URL</label>
                    <input 
                        type="text" 
                        id="url" 
                        placeholder="https://example.com"
                        value="https://example.com"
                    />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="maxPages">Max Pages</label>
                        <input 
                            type="number" 
                            id="maxPages" 
                            value="50"
                            min="1"
                            max="1000"
                        />
                    </div>

                    <div class="form-group">
                        <label for="delay">Delay (ms)</label>
                        <input 
                            type="number" 
                            id="delay" 
                            value="2000"
                            min="500"
                            max="10000"
                            step="500"
                        />
                    </div>
                </div>

                <div class="form-group">
                    <label for="outputDir">Output Directory</label>
                    <input 
                        type="text" 
                        id="outputDir" 
                        value="./recordings"
                    />
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="headless" />
                        <span>Headless Mode (no browser window)</span>
                    </label>
                </div>

                <div class="button-group">
                    <button id="startBtn" class="btn btn-primary">
                        ‚ñ∂Ô∏è Start Recording
                    </button>
                    <button id="stopBtn" class="btn btn-danger" disabled>
                        ‚èπÔ∏è Stop Recording
                    </button>
                </div>
            </section>

            <!-- Status Panel -->
            <section class="panel status-panel">
                <h2>Status</h2>
                
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">State:</span>
                        <span id="recordingState" class="status-value">Idle</span>
                    </div>
                    
                    <div class="status-item">
                        <span class="status-label">Session ID:</span>
                        <span id="sessionId" class="status-value">‚Äî</span>
                    </div>
                    
                    <div class="status-item">
                        <span class="status-label">Current URL:</span>
                        <span id="currentUrl" class="status-value">‚Äî</span>
                    </div>
                    
                    <div class="status-item">
                        <span class="status-label">Pages Visited:</span>
                        <span id="pagesVisited" class="status-value">0</span>
                    </div>
                    
                    <div class="status-item">
                        <span class="status-label">Pages Discovered:</span>
                        <span id="pagesDiscovered" class="status-value">0</span>
                    </div>
                </div>

                <div class="progress-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
            </section>

            <!-- Log Panel -->
            <section class="panel log-panel">
                <h2>Activity Log</h2>
                <div id="logContainer" class="log-container"></div>
            </section>
        </main>

        <footer>
            <p>SiteRecorder v0.1.0 | Cross-platform Site Crawler</p>
        </footer>
    </div>

    <script>
const { invoke } = window.__TAURI__.tauri;

// DOM Elements
const urlInput = document.getElementById('url');
const maxPagesInput = document.getElementById('maxPages');
const delayInput = document.getElementById('delay');
const outputDirInput = document.getElementById('outputDir');
const headlessCheckbox = document.getElementById('headless');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const recordingState = document.getElementById('recordingState');
const sessionId = document.getElementById('sessionId');
const currentUrl = document.getElementById('currentUrl');
const pagesVisited = document.getElementById('pagesVisited');
const pagesDiscovered = document.getElementById('pagesDiscovered');
const progressBar = document.getElementById('progressBar');
const logContainer = document.getElementById('logContainer');

let statusInterval = null;

// Add log entry
function addLog(message, type = 'info') {
    const logEntry = document.createElement('div');
    logEntry.className = `log-entry ${type}`;
    
    const time = new Date().toLocaleTimeString();
    logEntry.innerHTML = `
        <span class="log-time">[${time}]</span>
        <span class="log-message">${message}</span>
    `;
    
    logContainer.appendChild(logEntry);
    logContainer.scrollTop = logContainer.scrollHeight;
}

// Update status display
async function updateStatus() {
    try {
        const status = await invoke('get_status');
        
        if (status.is_running) {
            recordingState.textContent = 'Recording';
            recordingState.classList.add('recording');
        } else {
            recordingState.textContent = 'Idle';
            recordingState.classList.remove('recording');
        }
        
        sessionId.textContent = status.session_id || '‚Äî';
        currentUrl.textContent = status.current_url || '‚Äî';
        pagesVisited.textContent = status.pages_visited;
        pagesDiscovered.textContent = status.pages_discovered;
        
        // Update progress bar
        if (status.pages_discovered > 0) {
            const progress = (status.pages_visited / Math.max(status.pages_discovered, 1)) * 100;
            progressBar.style.width = `${Math.min(progress, 100)}%`;
        } else {
            progressBar.style.width = '0%';
        }
        
    } catch (error) {
        console.error('Failed to update status:', error);
    }
}

// Start recording
async function startRecording() {
    const settings = {
        url: urlInput.value.trim(),
        max_pages: parseInt(maxPagesInput.value),
        delay_ms: parseInt(delayInput.value),
        headless: headlessCheckbox.checked,
        output_dir: outputDirInput.value.trim()
    };
    
    // Validation
    if (!settings.url) {
        addLog('Please enter a URL', 'error');
        return;
    }
    
    if (!settings.url.startsWith('http://') && !settings.url.startsWith('https://')) {
        addLog('URL must start with http:// or https://', 'error');
        return;
    }
    
    try {
        addLog(`Starting recording for ${settings.url}`, 'info');
        
        const sessionId = await invoke('start_recording', { settings });
        
        addLog(`Recording started! Session ID: ${sessionId}`, 'success');
        
        // Update UI
        startBtn.disabled = true;
        stopBtn.disabled = false;
        disableInputs(true);
        
        // Start status polling
        statusInterval = setInterval(updateStatus, 1000);
        
    } catch (error) {
        addLog(`Failed to start recording: ${error}`, 'error');
    }
}

// Stop recording
async function stopRecording() {
    try {
        await invoke('stop_recording');
        addLog('Recording stopped by user', 'warning');
        
        // Update UI
        startBtn.disabled = false;
        stopBtn.disabled = true;
        disableInputs(false);
        
        // Stop status polling
        if (statusInterval) {
            clearInterval(statusInterval);
            statusInterval = null;
        }
        
        // Final status update
        await updateStatus();
        
    } catch (error) {
        addLog(`Failed to stop recording: ${error}`, 'error');
    }
}

// Disable/enable inputs
function disableInputs(disabled) {
    urlInput.disabled = disabled;
    maxPagesInput.disabled = disabled;
    delayInput.disabled = disabled;
    outputDirInput.disabled = disabled;
    headlessCheckbox.disabled = disabled;
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    startBtn.addEventListener('click', startRecording);
    stopBtn.addEventListener('click', stopRecording);
    
    addLog('SiteRecorder initialized', 'success');
    updateStatus();
});

// Cleanup on window close
window.addEventListener('beforeunload', () => {
    if (statusInterval) {
        clearInterval(statusInterval);
    }
});
    </script>
</body>
</html>
